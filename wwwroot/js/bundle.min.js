var calendar=function(){"use strict";var e="calendar",t=[],n=[],i=[],a=null,o=null,r=null,d=null,u=null,s=null,l=null,c=null,m=null,f=null,w=0,g=$("<audio>"),h=function(){var e=new Date;return e.setDate(e.getDate()-17),e.toISOString()},p=function(){var e=new Date;return e.setDate(e.getDate()+17),e.toISOString()},v={element:"#calendar",url:"https://www.googleapis.com/calendar/v3/calendars/{0}/events/",account:config.calendar.accounts[0].account,key:config.calendar.accounts[0].token,alwaysIncludeEmail:!1,showDeleted:!1,timeMin:h(),timeMax:p(),upcommingEvents:10,pastEvents:10,dateFormat:"dd MMMM",blinkSpeed:5e3,sound:"sounds/beep.mp3",debug:!1},y=function(e){v=$.extend({},v,e),v.element=$(v.element),v.debug=v.debug?v.debug:config.debug},b=function(){var e=_.omit(v,["url","account","upcommingEvents","pastEvents","element","dateFormat","sort"]);v.url=v.url.format(v.account),v.url+="?"+$.param(e)},D=function(){t=[],n=[],i=[],$.getJSON(v.url,function(e){M(e.items),R(),T()})},T=function(){t.forEach(function(e){if(e.recurrence){t=_.without(t,e);var n=v.url.replace("/events/","/events/"+e.recurrence+"/instances");$.getJSON(n,function(e){M(e.items),R()})}})},M=function(e){e.forEach(function(e){var n={title:e.summary.replace(/[❤️]/gm,"")||"",startDate:new Date(e.start.date||e.start.dateTime),endDate:new Date(e.end.date||e.end.dateTime),location:e.location||null,recurrence:e.recurrence?e.id:null};t.push(n)})},k=function(){n=_.filter(t,function(e){return e.startDate>=new Date||e.endDate>=new Date}),n=_.sortBy(n,function(e){return e.startDate}).filter(function(e,t){return t<v.upcommingEvents}),i=_.filter(t,function(e){return e.startDate<new Date&&e.endDate<new Date}),i=_.sortBy(i,function(e){return e.startDate}).reverse().filter(function(e,t){return t<v.pastEvents})},C=function(){sffjs.setCulture("nl-NL");var e=x(n),t=x(i),a=$('<thead><tr><th class="icon"></th><th></th><th></th></tr></thead>'),o=$("<tbody><tr><th colspan=3><h4>Historie</h4></th></tr></tbody>"),r=$("<table>");r.addClass("fader"),r.addClass("gradient"),r.append(a),r.append(e),r.append(o),r.append(t),v.element.html(r)},x=function(e){var t=$("<tbody>");return e.forEach(function(e){var n=S(e),i=e.startDate.format(v.dateFormat),a=$('<td class="glyphicon glyphicon-calendar">'),o=$("<th>").html(e.title),r=$('<td class="right">').html(i);r.attr({"data-diff":n,"data-date":i});var d=$("<tr>").append(a).append(o).append(r);t.append(d)}),t},S=function(e){var t=e.startDate,n=e.endDate,i=new Date,a=new Date(i.getFullYear(),i.getMonth(),i.getDate()),o=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=z(a,o).d;return i>=t&&n>i?"<span>Nu</span>":0==r&&(t>i||i>=n)?"Vandaag":1==r?"Morgen":-1==r?"Gister":r>0?r+" dgn.":0>r?Math.abs(r)+" dgn. gldn.":void 0},H=function(){v.blinkSpeed>0&&(window.clearTimeout(s),window.clearTimeout(l),window.clearTimeout(c),window.clearTimeout(m),l=window.setTimeout(O.bind("fadeOutSwitch","td[data-date]"),v.blinkSpeed-750),s=window.setTimeout(F,v.blinkSpeed),c=window.setTimeout(O.bind("fadeInSwitch","td[data-date]"),v.blinkSpeed+50),m=window.setTimeout(H,v.blinkSpeed+51))},F=function(){v.element.find("td[data-date]").each(function(e,t){t=$(t);var n=t.attr("data-date"),i=t.attr("data-diff"),a=n==t.html()?i:n;t.html(a)})},E=function(){var e=new Date,t=_.map(n,function(t){return e<t.startDate?t.startDate-e:t.endDate-e}),i=_.sortBy(t,function(e){return e});w=$(i).get(0)||5e3;var d=w/6e4>60?w/36e5:w/6e4,u=w/6e4>60?"hours.":"minutes.";console.log("Refresh calendar in",d.toFixed(2),u),window.clearTimeout(a),window.clearTimeout(r),window.clearTimeout(o),a=window.setTimeout(U,w-1e3),r=window.setTimeout(O.bind("fadeOutTable","table"),w-1e3),o=window.setTimeout(D,w)},N=function(){window.clearTimeout(u),window.clearTimeout(d),d=window.setTimeout(O.bind("fadeInTable","table"),10),u=window.setTimeout(E,11)},O=function(e){v.element.find(e).toggleClass("fader")},z=function(e,t){var n=Date.parse(t)-Date.parse(e);return isNaN(n)?NaN:{diff:n,ms:Math.floor(n%1e3),s:Math.floor(n/1e3%60),m:Math.floor(n/6e4%60),h:Math.floor(n/36e5%24),d:Math.floor(n/864e5)}},I=function(){""!=v.sound&&(g.attr({src:v.sound,autostart:!1,id:"sound"}),$("body").append(g))},U=function(){g.get(0).play()},W=function(){k(),C(),H(),N()},R=function(){window.clearTimeout(f),f=window.setTimeout(W,300)};return{name:e,init:function(e){y(e)},start:function(){b(),I(),D()},refresh:function(){E()}}}(),clock=function(){"use strict";var e="clock",t=new Date,n=null,i=null,a=null,o={element:"#clock",timeFormat:"h:mm tt",timeElement:"#time",dateFormat:"dddd, d MMMM yyyy",dateElement:"#date",blink:!0,fade:!0},r=function(e){o=$.extend({},o,e),o.element=$(o.element),o.element.addClass("module"),o.fade&&o.element.addClass("fader")},d=function(){sffjs.setCulture("en-US");var e=o.blink?o.timeFormat.replace(":","\\<\\b\\>:\\<\\/\\b\\>"):o.timeFormat;t=new Date;var n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()+1)-t,a=t.format(e);o.element.find("#time").html(a),i=window.setTimeout(d,n)},u=function(){sffjs.setCulture("nl-NL"),t=new Date;var e=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,100)-t,n=t.format(o.dateFormat);o.element.find("#date").html(n),a=window.setTimeout(u,e)},s=function(){window.clearTimeout(i),window.clearTimeout(a)},l=function(){var i="yyyy-MM-dd HH:mm",a=t.format(i),o=(new Date).format(i);a!=o&&(console.log(e.capitalize(),"Refresh"),window.clearTimeout(n),c(),d(),u(),n=window.setTimeout(c,1e3))},c=function(e){o.element.toggleClass("refresh")};return{name:e,init:function(e){r(e)},start:function(){d(),u()},stop:function(){s()},refresh:function(){l()}}}(),config={debug:!1,calendar:{accounts:[{account:"ramonklanke@gmail.com",token:"AIzaSyAw2WmFe2y1OJoFYIg3aKEzNXdX0AEGBYY"},{account:"inhousemedia@hotmail.com",token:"xxx"},{account:"evelienklein1@yahoo.com",token:"xxx"}]},weather:{accounts:[{account:"info@inhousemedia.nl",token:"791d3a107b2b02c20d44aed4607f7895"}]}},modules=function(){"use strict";var e={modules:{}},t=function(){$("body").on("refresh",o)},n=function(t,n){var i={};i[t.name]=t,i[t.name].init(n),e.modules=$.extend({},e.modules,i)},i=function(t){delete e.modules[t]},a=function(){_.mapObject(e.modules,function(e){e.start()})},o=function(t,n){return null==n?void _.mapObject(e.modules,function(e){e.refresh()}):n&&e.modules.hasOwnProperty(n)?void e.modules[n].refresh():void 0};return{init:function(){t()},start:function(){a()},register:function(e,t){n(e,t)},unregister:function(e){i(e)},refresh:function(e){o(null,e)}}}();String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}),String.prototype.capitalize||(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}),window.console||(window.console={});var refresh=function(){"use strict";var e=null,t=null,n=null,i=null,a=null,o=null,r=null,d=null,u={modules:[],motionDetection:!0,blurTimer:2e4,snapRate:800,sensitivity:10,videoWidth:640,videoHeight:480,imageWidth:64,imageHeight:48,debug:!1},s=function(e){u=$.extend({},u,e),u.element=$(u.element),u.debug=u.debug?u.debug:config.debug,n=$("<canvas>").attr({width:u.imageWidth,height:u.imageHeight}),i=n.get(0).getContext("2d")},l=function(e){u.modules.push(e)},c=function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1,0,0,0,10),n=Math.round((t-e)/1e3),i=$("<meta>").attr({"http-equiv":"refresh",content:n});i.insertAfter($("head meta[charset]"));var a=n/3600>1?n/3600:n/60,o=n/3600>1?"hours.":"minutes.";console.log("Refresh page in",a.toFixed(2),o)},m=function(){u.motionDetection&&(e=window.setTimeout(b,u.blurTimer))},f=function(){var e=$("<video>").attr({autoplay:!0,id:"motion",width:u.videoWidth,height:u.videoHeight});e.click(p),a=e.get(0),u.debug&&$("body").append(e)},w=function(){var e={video:!0};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia(e,function(e){a.src=window.URL.createObjectURL(e),a.play(),o=e}.bind(this),function(e){console.log(e.code)})},g=function(){r=$("<canvas>").attr({id:"canvas",width:u.imageWidth,height:u.imageHeight}),d=r.get(0).getContext("2d"),u.debug&&$("body").append(r)},h=function(){i.drawImage(a,0,0,u.videoWidth,u.videoHeight,0,0,u.imageWidth,u.imageHeight);var e=i.getImageData(0,0,u.imageWidth,u.imageHeight),t=e.data;return t},p=function(){var n,i,o=h();window.setTimeout(function(){n=h(),i=v(o,n),d.putImageData(i.imageData,0,0),u.debug&&($(r).css({border:"1px solid "+(i.procent>=u.sensitivity?"red":"transparent")}),$(a).css({border:"1px solid "+(i.procent>=u.sensitivity?"red":"transparent")})),i.procent>=u.sensitivity&&($("body").hasClass("loading")&&(y(),u.modules.forEach(function(e){e.refresh()})),console.log("motion trigger",i.procent,"%"),window.clearTimeout(e),e=window.setTimeout(b,u.blurTimer))},u.snapRate),t=window.setTimeout(p,u.snapRate)},v=function(e,t){for(var n=i.getImageData(0,0,u.imageWidth,u.imageHeight),a=n.data,o=0,r=0;r<e.length;r+=4){var d=(e[r]+e[r+1]+e[r+2])/3,s=(t[r]+t[r+1]+t[r+2])/3,l=Math.abs(d-s)>30?255:0;a[r]=l,a[r+1]=l,a[r+2]=l,o+=l>0?1:0}var c=Math.round(o/(e.length/4)*100);return u.debug&&console.log(c+"%"),{imageData:n,procent:c}},y=function(){$("body.loading").removeClass("loading")},b=function(){$("body").addClass("loading")};return{init:function(e){s(e),c(),m()},focus:function(){y()},blur:function(){b()},motion:function(){u.motionDetection&&(f(),w(),g(),p())},start:function(){w(),p()},stop:function(){o.active&&(window.clearTimeout(t),o.getTracks()[0].stop())},register:function(e){l(e)},unregister:function(e){var t=u.modules.indexOf(e);u.modules.splice(t,1)}}}();$(document).ready(function(){sffjs.setCulture("nl-NL"),modules.init(),modules.register(clock),modules.register(weather),modules.register(calendar,{upcommingEvents:3,pastEvents:3}),modules.start()}),$(window).load(function(){refresh.focus()});var weather=function(){"use strict";var e="weather",t=null,n=52.1006502,i=5.171758,a={coord:{lon:5.28,lat:52.7},weather:[{id:804,main:"Clouds",description:"overcast clouds",icon:"04d"}],base:"stations",main:{temp:16.21,pressure:1022,humidity:87,temp_min:12,temp_max:21.11},visibility:1e4,wind:{speed:6.7,deg:360},clouds:{all:90},dt:1465378214,sys:{type:1,id:5213,message:.0434,country:"NL",sunrise:1465355761,sunset:1465416037},id:2756076,name:"Gemeente Enkhuizen",cod:200},o={"01d":"wi-day-sunny","02d":"wi-day-cloudy","03d":"wi-cloudy","04d":"wi-cloudy-windy","09d":"wi-showers","10d":"wi-rain","11d":"wi-thunderstorm","13d":"wi-snow","50d":"wi-fog","01n":"wi-night-clear","02n":"wi-night-cloudy","03n":"wi-night-cloudy","04n":"wi-night-cloudy","09n":"wi-night-showers","10n":"wi-night-rain","11n":"wi-night-thunderstorm","13n":"wi-night-snow","50n":"wi-night-alt-cloudy-windy"},r={element:"#weather",url:"http://api.openweathermap.org/data/2.5/weather?units={3}&lat={0}&lon={1}&appid={2}",account:config.weather.accounts[0].account,key:config.weather.accounts[0].token,dateformat:"HH:mm",units:"metric",refresh:15,debug:!1},d=function(e){r=$.extend({},r,e),r.element=$(r.element),r.debug=r.debug?r.debug:config.debug,r.element.addClass("module refresh")},u=function(){navigator.geolocation.getCurrentPosition(s,l)},s=function(e){n=e.coords.latitude,i=e.coords.longitude,g()},l=function(t){console.warning(e.capitalize(),"No location found"),g()},c=function(){r.url=r.url.format(n,i,r.key,r.units)},m=function(){$.getJSON(r.url,function(e){e.dt!=a.dt&&(a=e,w())},function(){console.warning(e.capitalize(),"No data found")})},f=function(e){var t="";return e>=350&&10>=e?t="wi wi-wind-north":e>10&&80>e?t="wi wi-wind-north-east":e>=80&&100>=e?t="wi wi-wind-east":e>100&&170>e?t="wi wi-wind-south-east":e>=170&&190>=e?t="wi wi-wind-south":e>190&&260>e?t="wi wi-wind-south-west":e>=260&&280>=e?t="wi wi-wind-west":e>280&&350>e&&(t="wi wi-wind-north-west"),t},w=function(){sffjs.setCulture("nl-NL");var t=new Date,n=new Date(1e3*a.sys.sunrise),i=new Date(1e3*a.sys.sunset),d=t>n&&i>t?i:n,u=t>n&&i>t?"wi wi-sunset":"wi wi-sunrise",s=$("<h3>"),l=$("<span>").html(a.name.replace("Gemeente","").trim()),c=$('<span class="wi wi-strong-wind"></span>'),m=$("<span>").html(a.wind.speed),w=$("<span>").addClass(f(a.wind.deg)),g=$("<span>").addClass(u),i=$("<span>").html(d.format(r.dateformat));s.append(l).append(g).append(i).append(c).append(m).append(w);var h=$("<h1>"),p=$("<span>").addClass("wi "+o[$(a.weather).get(0).icon]),v="metric"==r.units?"&deg;":"";h.append(p).append(a.main.temp.toFixed(1)+v),r.element.find("#sunset").html(s),r.element.find("#temperature").html(h),console.log(e.capitalize(),"Last update",new Date(1e3*a.dt).format("yyyy-MM-dd HH:mm"))},g=function(){c(),m(),p(!1),v()},h=function(){v();var n=new Date(1e3*a.dt),i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()+r.refresh),o=new Date;i>o||(console.log(e.capitalize(),"Refresh",(new Date).format("yyyy-MM-dd HH:mm")),window.clearTimeout(t),p(),u())},p=function(e){"undefined"!=typeof e?r.element.toggleClass("refresh",e):r.element.toggleClass("refresh")},v=function(){window.clearTimeout(t),t=window.setTimeout(h,60*Math.round(r.refresh/3)*1e3)};return{name:e,init:function(e){d(e)},start:function(){return r.debug?void w():void u()},refresh:function(){h()}}}();